{
  "version": "tree-0.1",
  "tree": {
    "id": "App",
    "path": "",
    "children": {
      "BedrockAgentStack-Dev": {
        "id": "BedrockAgentStack-Dev",
        "path": "BedrockAgentStack-Dev",
        "children": {
          "BedrockAgentBucket": {
            "id": "BedrockAgentBucket",
            "path": "BedrockAgentStack-Dev/BedrockAgentBucket",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "BedrockAgentStack-Dev/BedrockAgentBucket/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::S3::Bucket",
                  "aws:cdk:cloudformation:props": {
                    "bucketEncryption": {
                      "serverSideEncryptionConfiguration": [
                        {
                          "serverSideEncryptionByDefault": {
                            "sseAlgorithm": "AES256"
                          }
                        }
                      ]
                    },
                    "bucketName": "bedrock-agent-dev-291412412747-ap-southeast-1",
                    "tags": [
                      {
                        "key": "aws-cdk:auto-delete-objects",
                        "value": "true"
                      }
                    ],
                    "versioningConfiguration": {
                      "status": "Enabled"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3.CfnBucket",
                  "version": "2.161.1"
                }
              },
              "Policy": {
                "id": "Policy",
                "path": "BedrockAgentStack-Dev/BedrockAgentBucket/Policy",
                "children": {
                  "Resource": {
                    "id": "Resource",
                    "path": "BedrockAgentStack-Dev/BedrockAgentBucket/Policy/Resource",
                    "attributes": {
                      "aws:cdk:cloudformation:type": "AWS::S3::BucketPolicy",
                      "aws:cdk:cloudformation:props": {
                        "bucket": {
                          "Ref": "BedrockAgentBucket21B034A2"
                        },
                        "policyDocument": {
                          "Statement": [
                            {
                              "Action": [
                                "s3:DeleteObject*",
                                "s3:GetBucket*",
                                "s3:List*",
                                "s3:PutBucketPolicy"
                              ],
                              "Effect": "Allow",
                              "Principal": {
                                "AWS": {
                                  "Fn::GetAtt": [
                                    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
                                    "Arn"
                                  ]
                                }
                              },
                              "Resource": [
                                {
                                  "Fn::GetAtt": [
                                    "BedrockAgentBucket21B034A2",
                                    "Arn"
                                  ]
                                },
                                {
                                  "Fn::Join": [
                                    "",
                                    [
                                      {
                                        "Fn::GetAtt": [
                                          "BedrockAgentBucket21B034A2",
                                          "Arn"
                                        ]
                                      },
                                      "/*"
                                    ]
                                  ]
                                }
                              ]
                            }
                          ],
                          "Version": "2012-10-17"
                        }
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_s3.CfnBucketPolicy",
                      "version": "2.161.1"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3.BucketPolicy",
                  "version": "2.161.1"
                }
              },
              "AutoDeleteObjectsCustomResource": {
                "id": "AutoDeleteObjectsCustomResource",
                "path": "BedrockAgentStack-Dev/BedrockAgentBucket/AutoDeleteObjectsCustomResource",
                "children": {
                  "Default": {
                    "id": "Default",
                    "path": "BedrockAgentStack-Dev/BedrockAgentBucket/AutoDeleteObjectsCustomResource/Default",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.CfnResource",
                      "version": "2.161.1"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.CustomResource",
                  "version": "2.161.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_s3.Bucket",
              "version": "2.161.1"
            }
          },
          "Custom::S3AutoDeleteObjectsCustomResourceProvider": {
            "id": "Custom::S3AutoDeleteObjectsCustomResourceProvider",
            "path": "BedrockAgentStack-Dev/Custom::S3AutoDeleteObjectsCustomResourceProvider",
            "children": {
              "Staging": {
                "id": "Staging",
                "path": "BedrockAgentStack-Dev/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.AssetStaging",
                  "version": "2.161.1"
                }
              },
              "Role": {
                "id": "Role",
                "path": "BedrockAgentStack-Dev/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.CfnResource",
                  "version": "2.161.1"
                }
              },
              "Handler": {
                "id": "Handler",
                "path": "BedrockAgentStack-Dev/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.CfnResource",
                  "version": "2.161.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.CustomResourceProviderBase",
              "version": "2.161.1"
            }
          },
          "BedrockAgentRole": {
            "id": "BedrockAgentRole",
            "path": "BedrockAgentStack-Dev/BedrockAgentRole",
            "children": {
              "ImportBedrockAgentRole": {
                "id": "ImportBedrockAgentRole",
                "path": "BedrockAgentStack-Dev/BedrockAgentRole/ImportBedrockAgentRole",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.161.1"
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "BedrockAgentStack-Dev/BedrockAgentRole/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::Role",
                  "aws:cdk:cloudformation:props": {
                    "assumeRolePolicyDocument": {
                      "Statement": [
                        {
                          "Action": "sts:AssumeRole",
                          "Effect": "Allow",
                          "Principal": {
                            "Service": "bedrock.amazonaws.com"
                          }
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "description": "Role for Bedrock Agent to access Nova Pro and other services",
                    "managedPolicyArns": [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "arn:",
                            {
                              "Ref": "AWS::Partition"
                            },
                            ":iam::aws:policy/AmazonBedrockFullAccess"
                          ]
                        ]
                      }
                    ],
                    "policies": [
                      {
                        "policyName": "BedrockAgentPolicy",
                        "policyDocument": {
                          "Statement": [
                            {
                              "Action": [
                                "bedrock:GetFoundationModel",
                                "bedrock:InvokeModel",
                                "bedrock:InvokeModelWithResponseStream",
                                "bedrock:ListFoundationModels"
                              ],
                              "Effect": "Allow",
                              "Resource": [
                                "arn:aws:bedrock:ap-southeast-1:291412412747:agent-alias/*",
                                "arn:aws:bedrock:ap-southeast-1:291412412747:agent/*",
                                "arn:aws:bedrock:ap-southeast-1:291412412747:inference-profile/apac.amazon.nova-pro-v1:0",
                                "arn:aws:bedrock:ap-southeast-1:291412412747:knowledge-base/*",
                                "arn:aws:bedrock:ap-southeast-1::foundation-model/amazon.nova-pro-v1:0"
                              ]
                            },
                            {
                              "Action": [
                                "s3:DeleteObject",
                                "s3:GetObject",
                                "s3:ListBucket",
                                "s3:PutObject"
                              ],
                              "Effect": "Allow",
                              "Resource": [
                                {
                                  "Fn::GetAtt": [
                                    "BedrockAgentBucket21B034A2",
                                    "Arn"
                                  ]
                                },
                                {
                                  "Fn::Join": [
                                    "",
                                    [
                                      {
                                        "Fn::GetAtt": [
                                          "BedrockAgentBucket21B034A2",
                                          "Arn"
                                        ]
                                      },
                                      "/*"
                                    ]
                                  ]
                                }
                              ]
                            }
                          ],
                          "Version": "2012-10-17"
                        }
                      }
                    ],
                    "roleName": "BedrockAgentStack-Dev-BedrockAgentRole"
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnRole",
                  "version": "2.161.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.Role",
              "version": "2.161.1"
            }
          },
          "AgentActionFunction": {
            "id": "AgentActionFunction",
            "path": "BedrockAgentStack-Dev/AgentActionFunction",
            "children": {
              "ServiceRole": {
                "id": "ServiceRole",
                "path": "BedrockAgentStack-Dev/AgentActionFunction/ServiceRole",
                "children": {
                  "ImportServiceRole": {
                    "id": "ImportServiceRole",
                    "path": "BedrockAgentStack-Dev/AgentActionFunction/ServiceRole/ImportServiceRole",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.Resource",
                      "version": "2.161.1"
                    }
                  },
                  "Resource": {
                    "id": "Resource",
                    "path": "BedrockAgentStack-Dev/AgentActionFunction/ServiceRole/Resource",
                    "attributes": {
                      "aws:cdk:cloudformation:type": "AWS::IAM::Role",
                      "aws:cdk:cloudformation:props": {
                        "assumeRolePolicyDocument": {
                          "Statement": [
                            {
                              "Action": "sts:AssumeRole",
                              "Effect": "Allow",
                              "Principal": {
                                "Service": "lambda.amazonaws.com"
                              }
                            }
                          ],
                          "Version": "2012-10-17"
                        },
                        "managedPolicyArns": [
                          {
                            "Fn::Join": [
                              "",
                              [
                                "arn:",
                                {
                                  "Ref": "AWS::Partition"
                                },
                                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                              ]
                            ]
                          }
                        ]
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_iam.CfnRole",
                      "version": "2.161.1"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.Role",
                  "version": "2.161.1"
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "BedrockAgentStack-Dev/AgentActionFunction/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Lambda::Function",
                  "aws:cdk:cloudformation:props": {
                    "code": {
                      "zipFile": "\nimport json\nimport boto3\nfrom datetime import datetime\n\ndef handler(event, context):\n    \"\"\"\n    Lambda function to handle Bedrock Agent actions\n    \"\"\"\n    print(f\"Received event: {json.dumps(event)}\")\n    \n    # Extract action and parameters from the event\n    action = event.get('actionGroup', '')\n    parameters = event.get('parameters', {})\n    \n    # Example action handlers\n    if action == 'get_current_time':\n        current_time = datetime.now().isoformat()\n        return {\n            'statusCode': 200,\n            'body': {\n                'TEXT': {\n                    'body': f\"The current time is: {current_time}\"\n                }\n            }\n        }\n    elif action == 'calculate':\n        # Example calculation action\n        try:\n            num1 = float(parameters.get('number1', 0))\n            num2 = float(parameters.get('number2', 0))\n            operation = parameters.get('operation', 'add')\n            \n            if operation == 'add':\n                result = num1 + num2\n            elif operation == 'subtract':\n                result = num1 - num2\n            elif operation == 'multiply':\n                result = num1 * num2\n            elif operation == 'divide':\n                result = num1 / num2 if num2 != 0 else 'Cannot divide by zero'\n            else:\n                result = 'Invalid operation'\n                \n            return {\n                'statusCode': 200,\n                'body': {\n                    'TEXT': {\n                        'body': f\"Result: {result}\"\n                    }\n                }\n            }\n        except Exception as e:\n            return {\n                'statusCode': 400,\n                'body': {\n                    'TEXT': {\n                        'body': f\"Error in calculation: {str(e)}\"\n                    }\n                }\n            }\n    else:\n        return {\n            'statusCode': 400,\n            'body': {\n                'TEXT': {\n                    'body': f\"Unknown action: {action}\"\n                }\n            }\n        }\n      "
                    },
                    "description": "Lambda function for Bedrock Agent custom actions",
                    "handler": "index.handler",
                    "role": {
                      "Fn::GetAtt": [
                        "AgentActionFunctionServiceRole003A432A",
                        "Arn"
                      ]
                    },
                    "runtime": "python3.11",
                    "timeout": 300
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_lambda.CfnFunction",
                  "version": "2.161.1"
                }
              },
              "Invokeu1TDdDMoLpes23omAp0kUXOcNSk--FsO0n9K--PkoXL68=": {
                "id": "Invokeu1TDdDMoLpes23omAp0kUXOcNSk--FsO0n9K--PkoXL68=",
                "path": "BedrockAgentStack-Dev/AgentActionFunction/Invokeu1TDdDMoLpes23omAp0kUXOcNSk--FsO0n9K--PkoXL68=",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Lambda::Permission",
                  "aws:cdk:cloudformation:props": {
                    "action": "lambda:InvokeFunction",
                    "functionName": {
                      "Fn::GetAtt": [
                        "AgentActionFunction45C8B7D6",
                        "Arn"
                      ]
                    },
                    "principal": "bedrock.amazonaws.com"
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_lambda.CfnPermission",
                  "version": "2.161.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_lambda.Function",
              "version": "2.161.1"
            }
          },
          "BedrockAgent": {
            "id": "BedrockAgent",
            "path": "BedrockAgentStack-Dev/BedrockAgent",
            "attributes": {
              "aws:cdk:cloudformation:type": "AWS::Bedrock::Agent",
              "aws:cdk:cloudformation:props": {
                "actionGroups": [
                  {
                    "actionGroupName": "utility-actions",
                    "description": "Utility functions for the agent",
                    "actionGroupExecutor": {
                      "lambda": {
                        "Fn::GetAtt": [
                          "AgentActionFunction45C8B7D6",
                          "Arn"
                        ]
                      }
                    },
                    "apiSchema": {
                      "payload": "{\"openapi\":\"3.0.0\",\"info\":{\"title\":\"Agent Utility API\",\"version\":\"1.0.0\",\"description\":\"API for agent utility functions\"},\"paths\":{\"/get_current_time\":{\"post\":{\"summary\":\"Get current time\",\"description\":\"Returns the current date and time\",\"operationId\":\"get_current_time\",\"responses\":{\"200\":{\"description\":\"Current time retrieved successfully\"}}}},\"/calculate\":{\"post\":{\"summary\":\"Perform calculations\",\"description\":\"Performs mathematical calculations\",\"operationId\":\"calculate\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"type\":\"object\",\"properties\":{\"number1\":{\"type\":\"number\",\"description\":\"First number\"},\"number2\":{\"type\":\"number\",\"description\":\"Second number\"},\"operation\":{\"type\":\"string\",\"enum\":[\"add\",\"subtract\",\"multiply\",\"divide\"],\"description\":\"Mathematical operation to perform\"}},\"required\":[\"number1\",\"number2\",\"operation\"]}}}},\"responses\":{\"200\":{\"description\":\"Calculation completed successfully\"}}}}}}"
                    }
                  }
                ],
                "agentName": "nova-pro-agent-dev",
                "agentResourceRoleArn": {
                  "Fn::GetAtt": [
                    "BedrockAgentRole7C982E0C",
                    "Arn"
                  ]
                },
                "autoPrepare": true,
                "description": "Bedrock Agent powered by Amazon Nova Pro model - Development",
                "foundationModel": "apac.amazon.nova-pro-v1:0",
                "instruction": "You are a helpful AI assistant powered by Amazon Nova Pro. \n      You can help users with various tasks including:\n      - Answering questions and providing information\n      - Performing calculations\n      - Providing current time information\n      - General conversation and assistance\n      \n      Be helpful, accurate, and professional in your responses.\n      If you're unsure about something, say so rather than guessing.",
                "promptOverrideConfiguration": {
                  "promptConfigurations": [
                    {
                      "promptType": "PRE_PROCESSING",
                      "promptCreationMode": "DEFAULT",
                      "promptState": "ENABLED",
                      "basePromptTemplate": "You are a helpful AI assistant. Process the user's request and determine the appropriate action to take.\n            \n            Available actions:\n            - get_current_time: Get the current date and time\n            - calculate: Perform mathematical calculations (add, subtract, multiply, divide)\n            \n            User request: $question$\n            \n            Please analyze the request and respond appropriately."
                    }
                  ]
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_bedrock.CfnAgent",
              "version": "2.161.1"
            }
          },
          "BedrockAgentAlias": {
            "id": "BedrockAgentAlias",
            "path": "BedrockAgentStack-Dev/BedrockAgentAlias",
            "attributes": {
              "aws:cdk:cloudformation:type": "AWS::Bedrock::AgentAlias",
              "aws:cdk:cloudformation:props": {
                "agentAliasName": "live",
                "agentId": {
                  "Fn::GetAtt": [
                    "BedrockAgent",
                    "AgentId"
                  ]
                },
                "description": "Live alias for the Nova Pro agent"
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_bedrock.CfnAgentAlias",
              "version": "2.161.1"
            }
          },
          "AgentId": {
            "id": "AgentId",
            "path": "BedrockAgentStack-Dev/AgentId",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.161.1"
            }
          },
          "AgentAliasId": {
            "id": "AgentAliasId",
            "path": "BedrockAgentStack-Dev/AgentAliasId",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.161.1"
            }
          },
          "AgentArn": {
            "id": "AgentArn",
            "path": "BedrockAgentStack-Dev/AgentArn",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.161.1"
            }
          },
          "S3BucketName": {
            "id": "S3BucketName",
            "path": "BedrockAgentStack-Dev/S3BucketName",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.161.1"
            }
          },
          "LambdaFunctionName": {
            "id": "LambdaFunctionName",
            "path": "BedrockAgentStack-Dev/LambdaFunctionName",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.161.1"
            }
          },
          "BedrockAgentRoleName": {
            "id": "BedrockAgentRoleName",
            "path": "BedrockAgentStack-Dev/BedrockAgentRoleName",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.161.1"
            }
          },
          "BedrockAgentRoleArn": {
            "id": "BedrockAgentRoleArn",
            "path": "BedrockAgentStack-Dev/BedrockAgentRoleArn",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.161.1"
            }
          },
          "CDKMetadata": {
            "id": "CDKMetadata",
            "path": "BedrockAgentStack-Dev/CDKMetadata",
            "children": {
              "Default": {
                "id": "Default",
                "path": "BedrockAgentStack-Dev/CDKMetadata/Default",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.CfnResource",
                  "version": "2.161.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.4.2"
            }
          },
          "BootstrapVersion": {
            "id": "BootstrapVersion",
            "path": "BedrockAgentStack-Dev/BootstrapVersion",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnParameter",
              "version": "2.161.1"
            }
          },
          "CheckBootstrapVersion": {
            "id": "CheckBootstrapVersion",
            "path": "BedrockAgentStack-Dev/CheckBootstrapVersion",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnRule",
              "version": "2.161.1"
            }
          }
        },
        "constructInfo": {
          "fqn": "aws-cdk-lib.Stack",
          "version": "2.161.1"
        }
      },
      "Tree": {
        "id": "Tree",
        "path": "Tree",
        "constructInfo": {
          "fqn": "constructs.Construct",
          "version": "10.4.2"
        }
      }
    },
    "constructInfo": {
      "fqn": "aws-cdk-lib.App",
      "version": "2.161.1"
    }
  }
}